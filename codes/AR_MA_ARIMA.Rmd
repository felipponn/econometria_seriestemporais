---
title: "Análise de séries temporais univariadas"
output:
  pdf_document: default
  html_document: default
date: "2025-10-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Autorregressive (AR) process 

## AR(1) process

```{r}
## Simulate a Gaussian AR(1) process
set.seed(1357)
tau2 = 0.01
phi1 = c(0.9,0.99,1.0,1.001)
n    = 10000
y    = matrix(0,n,4)
for (t in 2:n){
    y[t,] = rnorm(4,phi1*y[t-1,],sqrt(tau2))
}

range = range(y[,1:3])
par(mfrow=c(1,1))
ts.plot(y[,1],ylim=range,ylab="",lwd=2)
for (i in 2:4){
  lines(y[,i],col=i,lwd=2)
  legend("bottomleft",
         legend=c(expression(phi[1] ~ "=" ~ "0.90"),
                  expression(phi[1] ~ "=" ~ "0.99"),
                  expression(phi[1] ~ "=" ~ "1.00"),
                  expression(phi[1] ~ "=" ~ "1.001")),
         bty="n",col=1:4,lty=1,lwd=2)
  abline(h=0,lty=2)
}
```

### Autocorrelation function (ACF)

```{r}
par(mfrow=c(2,2))
for (i in 1:4){
  acf(y[,i],lag.max=50,main="")
  title(paste(expression(phi[1]), "=", phi1[i], sep=" "))
}
```

### Partial autocorrelation function (ACF)

```{r}
par(mfrow=c(2,2))
for (i in 1:4){
  pacf(y[,i],lag.max=50,main="")
  title(paste(expression(phi[1]), "=", phi1[i], sep=" "))
}
```


## AR(2) process

```{r}
## Simulate a Gaussian AR(2) process
set.seed(654321)
tau2 = 0.01
n    = 100000
y    = matrix(0,n,4)
y[,1] = arima.sim(n=n,model=list(ar=c(1.75,-0.85)),sd=sqrt(tau2))
y[,2] = arima.sim(n=n,model=list(ar=c(1.75,-0.7501)),sd=sqrt(tau2))
y[,3] = arima.sim(n=n,model=list(ar=c(0.9,0.0)),sd=sqrt(tau2))
y[,4] = arima.sim(n=n,model=list(ar=c(0.9,0.0999)),sd=sqrt(tau2))
```

### Autocorrelation function (ACF)

```{r}
range = range(y)
par(mfrow=c(2,4))
for (i in 1:4){
  ts.plot(y[,i],ylim=range,ylab="",main=paste("y",i,sep=""))
}
for (i in 1:4){
  acf(y[,i],lag.max=50,main="")
}
```

### Partial autocorrelation function (PACF)

```{r}
par(mfrow=c(2,4))
for (i in 1:4){
  ts.plot(y[,i],ylim=range,ylab="",main=paste("y",i,sep=""))
}
for (i in 1:4){
  pacf(y[,i],lag.max=50,main="")
}
```


## AR(p) for real GDP data

```{r}
library("tseries")
data = read.table("https://raw.githubusercontent.com/elara7/R-in-SOE/master/R/R-class/c11/data/q-gdp4708.txt",header=TRUE)

n     = nrow(data)   
gdp   = data[,4]
l_gdp = log(data[,4])
date  = data[,1]+data[,2]/12
```

### Autocorrelation function (ACF)

```{r}
par(mfrow=c(2,3))
plot(date,gdp,xlab="Year",ylab="GDP",type="l")
plot(date,l_gdp,xlab="Year",ylab="log-GDP",type="l")
plot(date[2:n],diff(l_gdp),xlab="Year",ylab="diff log-GDP",type="l")
acf(gdp,main="GDP")
acf(l_gdp,main="log-GDP")
acf(diff(l_gdp),main="diff log-GDP")
```

### Partial autocorrelation function (PACF)

```{r}
par(mfrow=c(2,3))
plot(date,gdp,xlab="Year",ylab="GDP",type="l")
plot(date,l_gdp,xlab="Year",ylab="log-GDP",type="l")
plot(date[2:n],diff(l_gdp),xlab="Year",ylab="diff log-GDP",type="l")
pacf(gdp,main="GDP")
pacf(l_gdp,main="log-GDP")
pacf(diff(l_gdp),main="diff log-GDP")
```

### Fit AR(p) model

```{r}
m1 = ar(diff(l_gdp),method="mle")
m1 
```


## AR(p) for AR(p) for real SP500 data

```{r}
da=read.table("https://raw.githubusercontent.com/elara7/R-in-SOE/master/R/R-class/c11/data/d-sp55008.txt",header=T)

n     = nrow(da)  
sp5   = da[,7]
l_sp5 = log(da[,7])
date  = da[,1]+(da[,2]*30+da[,3]/31)/366
```

### Autocorrelation function (ACF)

```{r}
par(mfrow=c(2,3))
plot(date,sp5,xlab="Days",ylab="SP500",type="l",main="Price")
plot(date,l_sp5,xlab="Days",ylab="SP500",type="l",main="log-Price")
plot(date[2:n],diff(l_sp5),xlab="Days",ylab="SP500",type="l",main="diff log-Price")
acf(sp5,main="Price")
acf(l_sp5,main="log-Price")
acf(diff(l_sp5),main="diff log-Price")
```

### Partial autocorrelation function (ACF)

```{r}
par(mfrow=c(2,3))
plot(date,sp5,xlab="Days",ylab="SP500",type="l",main="Price")
plot(date,l_sp5,xlab="Days",ylab="SP500",type="l",main="log-Price")
plot(date[2:n],diff(l_sp5),xlab="Days",ylab="SP500",type="l",main="diff log-Price")
pacf(sp5,main="Price")
pacf(l_sp5,main="log-Price")
pacf(diff(l_sp5),main="diff log-Price")
```

### Fit AR(p) model

```{r}
m2 = ar(diff(l_sp5),method="mle")
m2 
```



# Moving average (MA) process 

## MA(2) process

```{r}
## Simulate a MA(2) process
set.seed(132235)
tau2 = 0.01
th1  = 0.9
th2  = 0.5
n    = 500
y    = arima.sim(n=n,model=list(ma=c(th1,th2)),sd=sqrt(tau2))

par(mfrow=c(1,2))
ts.plot(y)
acf(y)
```

### Compute theoretical and empirical ACF 

```{r}
# Theoretical ACF
rho1 = (th1+th1*th2)/(1+th1^2+th2^2)
rho2 = (th2)/(1+th1^2+th2^2)

# Theoretical and empirical ACF
tab = cbind(c(rho1,rho2),acf(y)$acf[2:3])
rownames(tab) = c("lag1","lag2")
colnames(tab) = c("theoretical","empirical")
tab
```



# ARIMA process 

## auto.arima function 

```{r}
par(mfrow=c(1,1))
plot(Nile)
abline(v=1898,col=2)
```

### ACF and PACF

```{r}
par(mfrow=c(1,2))
acf(Nile)
pacf(Nile)
```

### Fit ARIMA(p,d,q) model

```{r}
library(forecast)
fit1 = auto.arima(Nile)
fit1
```